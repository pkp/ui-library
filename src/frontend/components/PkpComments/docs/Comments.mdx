import {Primary, Controls, Meta} from '@storybook/addon-docs/blocks';

import * as CommentsStories from './Comments.stories.js';

<Meta of={CommentsStories} />

# PkpComments

A flexible comments component for displaying publication comments with customizable slots.

<Primary />
<Controls />

## HTML Structure

The component uses BEM-style CSS class naming (`PkpComments__*`). Here is the rendered structure:

```html
<section class="PkpComments">
	<div class="PkpAccordion">
		<div class="PkpAccordionItem PkpComments__version">
			<!-- VERSION HEADER (slot: versionHeader) -->
			<button class="PkpAccordionHeader">
				<span class="PkpComments__versionHeaderLabel">
					Version 2 (3 comments)
				</span>
			</button>

			<div class="PkpAccordionContent PkpComments__content">
				<!-- LOGIN PROMPT (shown if not logged in) -->
				<button class="PkpComments__logInto pkp-button">
					Log in to comment
				</button>

				<!-- NOT LATEST VERSION NOTIFICATION -->
				<div class="PkpComments__notificationNotLatest">
					Discussion is closed for this version
				</div>

				<!-- NEW COMMENT FORM (slot: newComment) -->
				<div class="PkpComments__new">
					<div class="PkpComments__newInput">
						<textarea placeholder="Add your comment..."></textarea>
					</div>
					<button class="PkpComments__newSubmit pkp-button">Submit</button>
				</div>

				<!-- MESSAGES CONTAINER -->
				<div class="PkpComments__messages">
					<!-- INDIVIDUAL MESSAGE (slot: message) -->
					<article class="PkpComments__message">
						<!-- Pending approval notice (conditional) -->
						<div class="PkpComments__notificationNeedsApproval">
							Your comment is awaiting approval
						</div>

						<!-- Message header -->
						<div class="PkpComments__messageHeader">
							<time class="PkpComments__messageDate" datetime="2024-01-15">
								January 15, 2024
							</time>
							<div class="PkpComments__messageActions">
								<!-- Dropdown with Report/Delete actions -->
							</div>
						</div>

						<!-- Comment body -->
						<div class="PkpComments__messageBody">
							This is the comment text content...
						</div>

						<!-- Author info -->
						<footer class="PkpComments__messageAuthor">
							<span class="PkpComments__authorName">Maria Rodriguez</span>
							<div class="PkpComments__authorOrcid">
								<!-- PkpOrcidDisplay component renders here -->
							</div>
							<span class="PkpComments__authorAffiliation">
								University of Barcelona, Department of Biology
							</span>
						</footer>
					</article>
				</div>
			</div>
		</div>
	</div>
</section>
```

## Available Slots

<table>
	<thead>
		<tr>
			<th>Slot</th>
			<th>Scope Props</th>
			<th>Purpose</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				<code>default</code>
			</td>
			<td>
				<code>{'{ publications, store }'}</code>
			</td>
			<td>Override entire component with full store access</td>
		</tr>
		<tr>
			<td>
				<code>versionHeader</code>
			</td>
			<td>
				<code>{'{ publication, messages, store }'}</code>
			</td>
			<td>Customize version accordion header</td>
		</tr>
		<tr>
			<td>
				<code>newComment</code>
			</td>
			<td>
				<code>{'{ publication, store }'}</code>
			</td>
			<td>Customize new comment form</td>
		</tr>
		<tr>
			<td>
				<code>message</code>
			</td>
			<td>
				<code>{'{ message, publication, store }'}</code>
			</td>
			<td>Customize individual message</td>
		</tr>
	</tbody>
</table>

## Customizing in Plugins

All Base components are globally available. Override PkpComments by registering your own version:

```javascript
// Override PkpComments with custom message layout
pkp.registry.registerComponent('PkpComments', {
	template: `
		<BaseComments v-bind="$attrs">
			<template #message="{ message, publication }">
				<!-- Custom message layout -->
				<div class="my-custom-message">
					<strong>{{ message.userName }}</strong>
					<p>{{ message.commentText }}</p>
				</div>
			</template>
		</BaseComments>
	`,
});
```

### Available Base Components

<table>
	<thead>
		<tr>
			<th>Component</th>
			<th>Description</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>
				<code>BaseComments</code>
			</td>
			<td>Main container with slots for customization</td>
		</tr>
		<tr>
			<td>
				<code>BaseCommentsLogInto</code>
			</td>
			<td>Login button</td>
		</tr>
		<tr>
			<td>
				<code>BaseCommentsNew</code>
			</td>
			<td>New comment form wrapper</td>
		</tr>
		<tr>
			<td>
				<code>BaseCommentsNewInput</code>
			</td>
			<td>Comment textarea</td>
		</tr>
		<tr>
			<td>
				<code>BaseCommentsNewSubmit</code>
			</td>
			<td>Submit button</td>
		</tr>
		<tr>
			<td>
				<code>BaseCommentsMessageActions</code>
			</td>
			<td>Dropdown menu for message actions</td>
		</tr>
		<tr>
			<td>
				<code>BaseCommentsNotificationNotLatest</code>
			</td>
			<td>Closed discussion notice</td>
		</tr>
		<tr>
			<td>
				<code>BaseCommentsNotificationMessageNeedsApproval</code>
			</td>
			<td>Pending approval notice</td>
		</tr>
	</tbody>
</table>
